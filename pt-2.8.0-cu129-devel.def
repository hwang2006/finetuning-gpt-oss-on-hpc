Bootstrap: docker
From: ghcr.io/pytorch/pytorch:2.8.0-cuda12.9-cudnn9-devel

%labels
    Maintainer: $USER
    Base: ghcr.io/pytorch/pytorch:2.8.0-cuda12.9-cudnn9-devel
    Note: Adds git/curl/wget + UTF-8 locale + Asia/Seoul tz + mount targets

%environment
    export LANG=en_US.UTF-8
    export LANGUAGE=en_US:en
    export PATH=/opt/conda/bin:$PATH

%post
    set -e
    apt-get update
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
        git curl wget ca-certificates locales tzdata
    # Locale & timezone
    sed -i 's/^# *\(en_US.UTF-8 UTF-8\)/\1/' /etc/locale.gen
    locale-gen en_US.UTF-8
    update-locale LANG=en_US.UTF-8 LANGUAGE=en_US:en
    ln -sf /usr/share/zoneinfo/Asia/Seoul /etc/localtime
    # Bind mount targets commonly used on the cluster
    mkdir -p /scratch /home01 /apps
    # Slim
    apt-get clean
    rm -rf /var/lib/apt/lists/* /var/cache/apt/archives/*

%runscript
    exec "$@"
